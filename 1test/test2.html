<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .git *{
            padding: 8px;
            margin: 10px;
        }
        #map{
            width: 700px;
            height: 600px;
            margin-left: 2em;
        }
    </style>
</head>

<body>
    <div class="git">
        <div> github用户名<input type="text" name="username"><button>查询</button></div>
        <div class="content"></div>
    </div>

    <div class="info">
        <h4>天气</h4>
        <p id='forecast'></p>
    </div>
    <div id="map"></div>

    <script src="https://webapi.amap.com/maps?v=1.4.8&key=66a8cadd1a8263a4b1b6eaff4ce09fee&callback=init"></script>
    <script>
        //加载后初始化地图
        //传入要插入页面中元素的id并配置
        var lnglat = new AMap.LngLat(116.397, 39.918);

        window.init = function () {
            var map = new AMap.Map('map', {
                resizeEnable: true,
                mapStyle: "amap://styles/c0a45c01058d4cbfe54aca3ee8f8e105",
                center: lnglat,
                zoom: 11
            });

            if (location.href.indexOf('guide=1') !== -1) {
                map.setStatus({ scrollWheel: false });
                map.plugin(["AMap.ToolBar"], function () {
                    map.addControl(new AMap.ToolBar({ liteStyle: true }))
                });
            };

            //创建右键菜单
            var contextMenu = new AMap.ContextMenu();

            //右键放大
            contextMenu.addItem("放大一级", function () {
                map.zoomIn();
            }, 0);

            //右键缩小
            contextMenu.addItem("缩小一级", function () {
                map.zoomOut();
            }, 1);

            //右键显示全国范围
            contextMenu.addItem("缩放至全国范围", function (e) {
                map.setZoomAndCenter(4, [108.946609, 34.262324]);
            }, 2);

            //右键添加Marker标记
            contextMenu.addItem("添加标记", function (e) {
                var marker = new AMap.Marker({
                    map: map,
                    position: contextMenuPositon //基点位置
                });
            }, 3);

            //地图绑定鼠标右击事件——弹出右键菜单
            map.on('rightclick', function (e) {
                contextMenu.open(map, e.lnglat);
                contextMenuPositon = e.lnglat;
            });

            AMap.plugin('AMap.Weather', function () {
                let weather = new AMap.Weather();

                weather.getLive('西安', function (err, data) {
                    if (err)
                        return;

                    var str = [];
                    str.push('<p>城市/区：' + data.city + '</p>');
                    str.push('<p>天气：' + data.weather + '</p>');
                    str.push('<p>温度：' + data.temperature + '℃</p>');
                    str.push('<p>风向：' + data.windDirection + '</p>');
                    if (typeof (data.windPower) == NaN)
                        str.push('<p>风力：' + data.windPower + ' 级</p>');

                    str.push('<p>空气湿度：' + data.humidity + '</p>');
                    str.push('<p>发布时间：' + data.reportTime + '</p>');

                    document.getElementById('forecast').innerHTML = str.join(' ');

                    // 查询实时天气信息, 查询的城市到行政级别的城市，如朝阳区、杭州市
                    //     weather.getLive('朝阳区', function (err, data) {
                    //         if (!err) {
                    //             var str = [];
                    //             str.push('<h4 >实时天气' + '</h4><hr>');

                    //             var marker = new AMap.Marker({ map: map, position: map.getCenter() });
                    //             var infoWin = new AMap.InfoWindow({
                    //                 content: '<div class="info" style="position:inherit;margin-bottom:0;">' + str.join('') + '</div><div class="sharp"></div>',
                    //                 isCustom: true,
                    //                 offset: new AMap.Pixel(0, -37)
                    //             });
                    //             infoWin.open(map, marker.getPosition());
                    //             marker.on('mouseover', function () {
                    //                 infoWin.open(map, marker.getPosition());
                    //             });
                    //         }
                    //     });
                });
            });

        };




        let username = document.querySelector("input[name=username]");
        let info = document.querySelector(".content");
        let btn = document.querySelector("button");
        btn.addEventListener("click", () => {
            info.innerHTML = "";

            let http = new XMLHttpRequest;
            http.open("get", `https://api.github.com/users/${username.value}`);
            http.send();
            http.addEventListener('load', () => {
                let data = JSON.parse(http.responseText);
                for (let key in data) {
                    info.innerHTML += key + " —— " + data[key] + "<br>";
                }
            })
        })

    </script>
</body>

</html>